!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.DiffRender=t()}(this,function(){"use strict";function e(){}function t(e){return document.createElement(e)}function n(e,t){return document.createElementNS(e,t)}function r(e){return document.createTextNode(e)}function i(e,t,n){e.insertBefore(t,n)}function o(e,t){e.removeChild(t)}function a(e,t){e.appendChild(t)}function s(e){return e.parentElement}function l(e){return e.nextSibling}function c(e){return e.tagName}function d(e,t){e.textContent=t}function u(e){return void 0===e}function f(e){return void 0!==e}function h(e,t){return e.key===t.key&&e.sel===t.sel}function p(e,t,n){var r,i,o={};for(r=t;r<=n;++r)i=e[r].key,f(i)&&(o[i]=r);return o}function m(e,t){function n(e){var n=e.id?"#"+e.id:"",r=e.className?"."+e.className.split(" ").join("."):"";return v(t.tagName(e).toLowerCase()+n+r,{},[],void 0,e)}function r(e,n){return function(){if(0===--n){var r=t.parentNode(e);t.removeChild(r,e)}}}function i(e,n){var r,o=e.data;f(o)&&f(r=o.hook)&&f(r=r.init)&&(r(e),o=e.data);var a,s=e.children,l=e.sel;if(f(l)){var c=l.indexOf("#"),d=l.indexOf(".",c),u=c>0?c:l.length,h=d>0?d:l.length,p=c!==-1||d!==-1?l.slice(0,Math.min(u,h)):l;if(a=e.elm=f(o)&&f(r=o.ns)?t.createElementNS(r,p):t.createElement(p),u<h&&(a.id=l.slice(u+1,h)),d>0&&(a.className=l.slice(h+1).replace(/\./g," ")),x.array(s))for(r=0;r<s.length;++r)t.appendChild(a,i(s[r],n));else x.primitive(e.text)&&t.appendChild(a,t.createTextNode(e.text));for(r=0;r<g.create.length;++r)g.create[r](y,e);r=e.data&&e.data.hook,f(r)&&(r.create&&r.create(y,e),r.insert&&n.push(e))}else a=e.elm=t.createTextNode(e.text);return e.elm}function o(e,n,r,o,a,s){for(;o<=a;++o)t.insertBefore(e,i(r[o],s),n)}function a(e){var t,n,r=e.data;if(f(r)){for(f(t=r.hook)&&f(t=t.destroy)&&t(e),t=0;t<g.destroy.length;++t)g.destroy[t](e);if(f(t=e.children))for(n=0;n<e.children.length;++n)a(e.children[n])}}function s(e,n,i,o){for(;i<=o;++i){var s,l,c,d=n[i];if(f(d))if(f(d.sel)){for(a(d),l=g.remove.length+1,c=r(d.elm,l),s=0;s<g.remove.length;++s)g.remove[s](d,c);f(s=d.data)&&f(s=s.hook)&&f(s=s.remove)?s(d,c):c()}else t.removeChild(e,d.elm)}}function l(e,n,r,a){for(var l,d,f,m,g=0,v=0,x=n.length-1,T=n[0],y=n[x],k=r.length-1,N=r[0],C=r[k];g<=x&&v<=k;)u(T)?T=n[++g]:u(y)?y=n[--x]:h(T,N)?(c(T,N,a),T=n[++g],N=r[++v]):h(y,C)?(c(y,C,a),y=n[--x],C=r[--k]):h(T,C)?(c(T,C,a),t.insertBefore(e,T.elm,t.nextSibling(y.elm)),T=n[++g],C=r[--k]):h(y,N)?(c(y,N,a),t.insertBefore(e,y.elm,T.elm),y=n[--x],N=r[++v]):(u(l)&&(l=p(n,g,x)),d=l[N.key],u(d)?(t.insertBefore(e,i(N,a),T.elm),N=r[++v]):(f=n[d],c(f,N,a),n[d]=void 0,t.insertBefore(e,f.elm,T.elm),N=r[++v]));g>x?(m=u(r[k+1])?null:r[k+1].elm,o(e,m,r,v,k,a)):v>k&&s(e,n,g,x)}function c(e,n,r){var a,c;f(a=n.data)&&f(c=a.hook)&&f(a=c.prepatch)&&a(e,n);var d=n.elm=e.elm,p=e.children,m=n.children;if(e!==n){if(!h(e,n)){var v=t.parentNode(e.elm);return d=i(n,r),t.insertBefore(v,d,e.elm),void s(v,[e],0,0)}if(f(n.data)){for(a=0;a<g.update.length;++a)g.update[a](e,n);a=n.data.hook,f(a)&&f(a=a.update)&&a(e,n)}u(n.text)?f(p)&&f(m)?p!==m&&l(d,p,m,r):f(m)?(f(e.text)&&t.setTextContent(d,""),o(d,null,m,0,m.length-1,r)):f(p)?s(d,p,0,p.length-1):f(e.text)&&t.setTextContent(d,""):e.text!==n.text&&t.setTextContent(d,n.text),f(c)&&f(a=c.postpatch)&&a(e,n)}}var d,m,g={};for(u(t)&&(t=T),d=0;d<k.length;++d)for(g[k[d]]=[],m=0;m<e.length;++m)void 0!==e[m][k[d]]&&g[k[d]].push(e[m][k[d]]);return function(e,r){var o,a,l,d=[];for(o=0;o<g.pre.length;++o)g.pre[o]();for(u(e.sel)&&(e=n(e)),h(e,r)?c(e,r,d):(a=e.elm,l=t.parentNode(a),i(r,d),null!==l&&(t.insertBefore(l,r.elm,t.nextSibling(a)),s(l,[e],0,0))),o=0;o<d.length;++o)d[o].data.hook.insert(d[o]);for(o=0;o<g.post.length;++o)g.post[o]();return r}}function g(e,t){"string"==typeof e&&(e=E.parse(e)),"string"==typeof t&&(t=E.parse(t)),C(e,t)}e.prototype={handler:null,startTagRe:/^<([^>\s\/]+)((\s+[^=>\s]+(\s*=\s*((\"[^"]*\")|(\'[^']*\')|[^>\s]+))?)*)\s*\/?\s*>/m,endTagRe:/^<\/([^>\s]+)[^>]*>/m,attrRe:/([^=\/\s]+)(\s*=\s*((\"([^"]*)\")|(\'([^']*)\')|[^>\s]+))?/gm,stack:[],parse:function(e){var t={sel:"div",children:[],isRoot:!0};this.stack=[t];for(var n,r,i,o,a=!1,s=this;e.length>0;)"<!--"==e.substring(0,4)?(o=e.indexOf("-->"),a=o==-1):"</"==e.substring(0,2)?this.endTagRe.test(e)?(n=RegExp.leftContext,r=RegExp.lastMatch,i=RegExp.rightContext,r.replace(this.endTagRe,function(){return s.parseEndTag.apply(s,arguments)}),e=i,a=!1):a=!0:"<"==e.charAt(0)&&(this.startTagRe.test(e)?(n=RegExp.leftContext,r=RegExp.lastMatch,i=RegExp.rightContext,r.replace(this.startTagRe,function(){return s.parseStartTag.apply(s,arguments)}),e=i,a=!1):a=!0),a&&(o=e.indexOf("<"),o==-1?(this.parseText(e),e=""):(this.parseText(e.substring(0,o)),e=e.substring(o))),a=!0;if(0===t.children.length)throw new Error("HTML不标准,请检查标签是否闭合!");return 1===t.children.length?t.children[0]:t},setStackTopNode:function(e){var t=this.stack[this.stack.length-1];if(!t)throw new Error("HTML不标准,请检查标签是否闭合!");e(t)},parseText:function(e){this.setStackTopNode(function(t){return t.children?void t.children.push({sel:"span",text:e}):void(t.text=e)})},parseStartTag:function(e,t,n){var r=this.parseAttributes(t,n);return"/>"===e.substr(-2)?void this.setStackTopNode(function(e){e.children=e.children||[],e.text&&(e.children.push({sel:"span",text:e.text}),delete e.text),e.children.push({sel:t,data:{attr:r}})}):void this.stack.push({sel:t,data:{attr:r}})},parseEndTag:function(e,t){var n=this.stack.pop();this.setStackTopNode(function(e){e.children=e.children||[],e.text&&(e.children.push({sel:"span",text:e.text}),delete e.text),e.children.push(n)})},parseAttributes:function(e,t){var n=this,r={};return t.replace(this.attrRe,function(t,i,o,a,s,l,c){var d=n.parseAttribute(e,t,i,o,a,s,l,c);r[d.name]=d.value}),r},parseAttribute:function(e,t,n){var r="";arguments[7]?r=arguments[8]:arguments[5]?r=arguments[6]:arguments[3]&&(r=arguments[4]);var i=!r&&!arguments[3];return{name:n,value:!!i||r}}};var v=function(e,t,n,r,i){var o=void 0===t?void 0:t.key;return{sel:e,data:t,children:n,text:r,elm:i,key:o}},x={array:Array.isArray,primitive:function(e){return"string"==typeof e||"number"==typeof e}},T={createElement:t,createElementNS:n,createTextNode:r,appendChild:a,removeChild:o,insertBefore:i,parentNode:s,nextSibling:l,tagName:c,setTextContent:d},y=v("",{},[],void 0,void 0),k=["create","update","remove","destroy","pre","post"],N={init:m},C=N.init([]),E=new e,R={patch:g};return R});